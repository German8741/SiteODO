const events = [
  
 {
    id: 11,
    imageUrl: '/assets/images/afisha/петровслайдер.jpeg',
    imageAfisha: '/assets/images/afisha/петров.png',
    title: 'Алексей Петров «Страна героев»',
    date: '22 июня, 19:00',
    venue: 'Арт-Холл «Малый зал»',
    price: 'от 500р',
    age: '12+',
    link: './polnaya-afisha.html?id=11',
    pushkinCard: false,
    watchSlider: true,
    kassyLink: 'https://ekb.kassy.ru/events/koncerty-i-shou/2-64922/',
    odoLink: 'оплата.html',
    description: 'В день начала Вов мы предлагаем Вам вместе с нами окунутся в атмосферу 30-х — 50-х годов ХХ века. Время энтузиазма, свершений, героизма и побед. Вместе — спеть любимые с детства песни Леонида Утесова, Марка Бернеса, Исаака Дунаевского, Геога Отса; услышать забавные истории из жизни артистов.'
},
{
    id: 12,
    imageUrl: '/assets/images/afisha/маценко.jpg',
    imageAfisha: '/assets/images/afisha/маценкоафиша.jpg',
    title: 'Арт-лекция «Васнецовы богатыри» ',
    date: '18 июня, 18:30',
    venue: 'Арт-Холл «Малый зал»',
    price: '400р',
    age: '0+',
    link: './polnaya-afisha.html?id=12',
    pushkinCard: false,
    watchSlider: true,
    kassyLink: 'https://ekb.kassy.ru/shows/seminary/2-8123/',
    odoLink: 'оплата.html',
    description: 'Арт-лекция «Васнецовы богатыри» из цикла Надежды Маценко «Живые художники». Виктор Михайлович Васнецов (1848–1926) – русский художник, живописец, архитектор. Создатель сказочных, мифологических, фольклорных интонаций в отечественном изобразительном искусстве. Не будет преувеличением сказать, что картины Виктора Васнецова «Богатыри», «Витязь на распутье», «Алёнушка», «Иван Царевич на Сером волке» известны каждому. А что мы знаем о личности этого художника? Материалы личной переписки, статьи современников, результаты работы искусствоведов дают интересную основу для глубокого восприятия искусства Васнецова. Не стереотипного, не шаблонного и поверхностного, но многогранного и вдумчивого... Лекция сопровождается показом слайдов и книг, в том числе редких и малоизвестных широкой публике.'
},
  {
    id: 13,
    imageUrl: '/assets/images/afisha/ochemwomansilence.png',
    imageAfisha: '/assets/images/afisha/ochemwomanafisha.jpg',
    title: 'О чем молчит женщина',
    date: '19 июня, 19:00',
    venue: 'Арт-Холл «Малый зал»',
    price: 'от 500 р',
    age: '16+',
    link: './polnaya-afisha.html?id=13',
    pushkinCard: false,
    watchSlider: true,
    kassyLink: 'https://ekb.kassy.ru/events/koncerty-i-shou/2-64710/',
    odoLink: 'оплата.html',
    description: 'СВЕТЛАНА КОТОВА в концерте за столиками "О чем молчит женщина". Поводов для молчания женщины ... достаточно. О любви и разлуке, о радости и неудаче, о мечтах и чаяниях... Женщина молчит. Нет! Женщина поёт! ✓ Любимые песни в новом прочтении; ✓ Разговоры о личном; ✓ Романтическая гитара РОМАНА ГУСЕВА. Приходите! Давайте вместе услышим, о чем молчит женщина.'
  },
  {
    id: 14,
    imageUrl: '/assets/images/afisha/ochemwomansilence.png',
    imageAfisha: '/assets/images/afisha/мистерзонтик.jpg',
    title: 'Шоу Мистера Зонтика',
    date: '16 июня, 11:00',
    venue: 'Большой зал',
    price: '350 р',
    age: '0+',
    link: './polnaya-afisha.html?id=14',
    pushkinCard: false,
    watchSlider: false,
    kassyLink: 'https://ekb.kassy.ru/events/detskie/2-64897/',
    odoLink: 'оплата.html',
    description: 'Друзья, приглашаем вас в Дом офицеров на иллюзионное представление «ШОУ МИСТЕРА ЗОНТИКА». В главной роли — многократный чемпион России по сценической магии, победитель международных конкурсов в Финляндии и в Китае, участник чемпионата Европы по иллюзионному искусству Илья Ильин. Это новое имя в мире магии — сочетание юмора, интерактивности и детского стендапа, которое порадует вас и вашу семью. В программе — лучшие номера: шоу зонтов, крупные иллюзии, интерактивные номера, в которых дети, на глазах изумленной публики, творят магию своими руками. В течении 10 лет Илья Ильин участвует в представлениях, как для взрослой аудитории, так и для малышей в возрасте от 3-х лет. За этот период времени выросло целое поколение мальчишек и девчонок, которые всей душой полюбили Мистера Зонтика. Шоу рассчитано на детскую аудиторию, но уверены, что погрузится в солнечный и радостный мир детства, будет приятно и их родителям. Откройте для себя мир волшебства и фантазии вместе со всей семьей, наслаждаясь яркими и захватывающими номерами шоу Мистера Зонтика.'
  },
    {
    id: 15,
    imageUrl: '#',
    imageAfisha: '/assets/images/afisha/hottabich.jpg',
    title: 'Хоттабыч навсегда',
    date: '25 июня, 18:30',
    venue: 'Большой зал',
     price: 'от 600р',
    age: '0+',
    link: './polnaya-afisha.html?id=15',
    pushkinCard: false,
    watchSlider: false,
    kassyLink: 'https://ekb.kassy.ru/events/teatr/8-27620758/hall/?t=1748511777',
    odoLink: 'оплата.html',
    description: 'Знаменитый сюжет перенесен в наше время, когда люди отстранены друг от друга и каждый человек одинок. И только мальчик Волька постоянно хочет познавать новое, дружить. Его сердце открыто чудесам этого мира.<br>И именно он смог освободить доброго волшебника Хоттабыча от злого проклятья Сулеймана ибн Дауда. С этого момента чудеса входят в жизнь не только Вольки, но и в жизни его друзей и знакомых.<br>И все - и красотка Женя, и хулиган Гога, и бизнесмены Хапугины, и даже инспектор полиции станут совершенно другими людьми.<br>Но, главный вопрос, победит ли Хоттабыч злого Сулеймана ибн Дауда, или снова окажется в заточении древнего кувшина? Вернётся ли к ребятам обратно?<br>Достойны мы волшебства в нашей жизни? Сможем ли мы, если у нас будет такая возможность, с помощью чудес помогать другим людям, а не только себе?<br>Наверное, нам всем надо почувствовать Волшебство внутри себя! И тогда, вокруг нас изменится мир к лучшему!<br>Об этом вечная и такая современная сказка - мюзикл "Хоттабыч навсегда".<br><br>ХОТТАБЫЧ - Сергей Кораблёв.<br>ВОЛЬКА - Александр Терехов (13 лет).<br>СУПРУГИ ХАПУГИНЫ - Анастасия Куракова, Алексей Рычков.<br>ЖЕНЯ - Женя Удачина (15 лет), Маша Гаврилова (12 лет).<br>ГОГА - Ксения Жилка (15 лет), Аня Харина (13 лет).<br>НЕУДЕРЖИМЫЙ ДЖО - Алексей Рычков.<br>КРАСОТКА МЕРИ - Анастасия Куракова.<br>ИНСПЕКТОР ПОЛИЦИИ ЦЫЦ - Варя Иванова (13 лет), Соня Червякова (13 лет).<br>ДЕЖУРНЫЕ В ОТДЕЛЕНИИ - Анастасия Куракова, Алексей Рычков.<br>В спектакле участвует хореографическая Группа "Сапсан".<br>РЕЖИССЁР - ПОСТАНОВЩИК - Александр Стариков.<br>ВОКАЛЬНЫЙ РУКОВОДИТЕЛЬ - Милена Думачева.<br>ХОРЕОГРАФ - ПОСТАНОВЩИК - Полина Булатова.'
  },
  {
    id: 16,
    imageUrl: '/assets/images/afisha/проскоморохислайдер.jpg',
    imageAfisha: '/assets/images/afisha/проскоморохи.jpg',
    title: 'proСКОМОРОХИ «Девятнадцать лет в ритме танца» ',
    date: '19 июня, 19:00',
    venue: 'Большой зал',
    price: '500 р',
    age: '0+',
    link: './polnaya-afisha.html?id=16',
    pushkinCard: false,
    watchSlider: true,
    kassyLink: 'https://ekb.kassy.ru/events/koncerty-i-shou/2-64898/',
    odoLink: 'оплата.html',
    description: 'Большой зал Дома офицеров Центрального военного округа Студия танца «proСКОМОРОХИ» приглашает вас на грандиозный отчетный концерт, посвященный завершению 19-го творческого сезона. Коллектив, основанный в 2006 году, представит зрителю яркую и самобытную программу, в которой переплетаются народные мотивы и современная хореография. За годы своего существования участники коллектива покоряли множество сцен, а его юные артисты не раз доказывали высочайший уровень мастерства на престижных танцевальных конкурсах и фестивалях. Специальный гость – Ансамбль песни и пляски Центрального военного округа.'
  }
  ];
  

function parseDate(dateStr) {
  const [dayMonth, time] = dateStr.split(', ');
  const [day, month] = dayMonth.split(' ');
  const monthIndex = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'].indexOf(month.toLowerCase());
  const [hours, minutes] = time.split(':');
  const year = 2025;
  return new Date(year, monthIndex, parseInt(day), parseInt(hours), parseInt(minutes));
}

function getDayOfWeek(dateStr) {
  const [dayMonth, time] = dateStr.split(', ');
  const [day, month] = dayMonth.split(' ');
  const monthIndex = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'].indexOf(month.toLowerCase());
  const date = new Date(2025, monthIndex, parseInt(day));
  const days = ['вс', 'пн', 'вт', 'ср', 'чт', 'пт', 'сб'];
  return days[date.getDay()];
}

function sortEventsByDate(eventsArray) {
  return [...eventsArray].sort((a, b) => {
    const dateA = parseDate(a.date);
    const dateB = parseDate(b.date);
    return dateA - dateB;
  });
}

function renderAfishaCards() {
  const cardsContainer = document.getElementById('cards');
  if (!cardsContainer) {
    console.warn('Cards container not found');
    return;
  }

  const sortedEvents = sortEventsByDate(events);
  
  sortedEvents.forEach(slide => {
    console.log('Rendering card with link:', slide.link);
    const [dayMonth, time] = slide.date.split(', ');
    const dayOfWeek = getDayOfWeek(slide.date);
    const card = document.createElement('a');
    card.className = 'card';
    card.href = slide.link;
    card.innerHTML = `
      <div class="card-image" style="background-image: url(${slide.imageAfisha || 'https://i.postimg.cc/k5PW2SHr/afisha-zaglushka.jpg'})">
        <div class="age-badge">${slide.age}</div>
        <div class="price-badge">${slide.price}</div>
        ${slide.pushkinCard ? `
          <div class="pushkin-badge">
            <img src="assets/svg_icons/pushkin.png" class="pushkin-icon" alt="Pushkin Card">
          </div>
        ` : ''}
      </div>
      <div class="card-info">
        <div class="card-title">${slide.title}</div>
        <div class="card-date">
          <span>${dayMonth}, ${dayOfWeek}</span>
          <div class="date-dot"></div>
          <span>${time}</span>
        </div>
        <div class="card-venue">${slide.venue}</div>
      </div>
    `;
    card.addEventListener('click', (e) => {
      console.log('Card clicked, navigating to:', card.href);
    });
    cardsContainer.appendChild(card);
  });
}

function initSlider() {
  const cardsContainer = document.querySelector('.cards');
  if (!cardsContainer) {
    console.warn('Cards container not found for slider');
    return;
  }

  // Обрабатываем только клики, чтобы избежать свайпов как кликов
  cardsContainer.addEventListener('click', (event) => {
    const card = event.target.closest('.card');
    if (card && card.href) {
      event.preventDefault(); // Предотвращаем стандартный клик
      window.location.href = card.href; // Переходим по ссылке
    }
  });

  // Отключаем контекстное меню для предотвращения конфликтов
  cardsContainer.addEventListener('contextmenu', (event) => {
    event.preventDefault();
  });
}

function getEventById(id) {
  return events.find(event => event.id === parseInt(id));
}

function renderEventDetails() {
  // Вызываем только на странице polnaya-afisha.html
  if (!window.location.pathname.includes('polnaya-afisha.html')) {
    return;
  }

  const urlParams = new URLSearchParams(window.location.search);
  const eventId = urlParams.get('id');
  const event = getEventById(eventId);

  console.log('Extracted eventId:', eventId);
  console.log('Found event:', event);

  if (!event) {
    const section = document.querySelector('.events-detail-section');
    if (section) {
      section.innerHTML = '<p>Событие не найдено</p>';
    }
    return;
  }

  document.querySelector('.event-image').src = event.imageAfisha;
  document.querySelector('.age-badge').textContent = event.age;
  document.querySelector('.event-title').textContent = event.title;
  document.querySelector('.event-button').href = event.odoLink;
 document.querySelector('.details-item:nth-child(1)').innerHTML = `<span class="details-label">Дата:</span> <span class="details-value">${event.date.split(', ')[0]}</span>`;
document.querySelector('.details-item:nth-child(2)').innerHTML = `<span class="details-label">Время:</span> <span class="details-value">${event.date.split(', ')[1]}</span>`;
document.querySelector('.details-item:nth-child(3)').innerHTML = `<span class="details-label">Место:</span> <span class="details-value">${event.venue}</span>`;
document.querySelector('.details-item:nth-child(4)').innerHTML = `<span class="details-label">Цена:</span> <span class="details-value">${event.price}</span>`;
  document.querySelector('.ticket-button').href = event.kassyLink;
  document.querySelector('.event-description p').textContent = event.description;
}

// Заглушка для zalyManager
const zalyManager = {
  initZaly: () => {
    console.log('zalyManager.initZaly() called (placeholder)');
  }
};

// Заглушка для manager (слайдер обрабатывается в slider/manager.js)
const manager = {
  initSlider: () => {
    console.log('manager.initSlider() called (placeholder)');
  }
};

document.addEventListener('DOMContentLoaded', () => {
  renderAfishaCards();
  initSlider();
  renderEventDetails();
});

export { events, sortEventsByDate, renderAfishaCards, manager, zalyManager };